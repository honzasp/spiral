(program
  (import std)
  (import std.test)
  (import std.array)

  (test "ref?" (lambda (t)
    (assert t (ref? (ref-new 99)))
    (assert-not t (ref? (sym-new "a sym")))
    (assert-not t (ref? "not a ref"))))

  (test "ref-get" (lambda (t)
    (let ((r0 (ref-new 1000))
          (r1 (ref-new "baz")))
      (assert-eqv t (ref-get r0) 1000)
      (assert-eqv t (ref-get r1) "baz"))))

  (test "ref-set!" (lambda (t)
    (let ((r0 (ref-new "baz"))
          (ary0 (array-new))
          (ary1 (array-new))
          (r1 (ref-new ary0))
          (r2 (ref-new ary0)))
      (assert-eqv t (ref-get r0) "baz")
      (assert-eqv t (ref-get r1) (ref-get r2))
      (ref-set! r0 "foo")
      (assert-eqv t (ref-get r0) "foo")
      (ref-set! r0 1234)
      (assert-eqv t (ref-get r0) 1234)
      (ref-set! r2 ary1)
      (assert-eqv t (ref-get r1) ary0)
      (assert-eqv t (ref-get r2) ary1)))))
