(program
  (import std)
  (fun alloc-use (depth)
    (var ary-1 (make-array 100))
    (array-set! ary-1 4 depth)
    (array-set! ary-1 2 ary-1)
    (var ary-2 ary-1)
    (var prev-ok (alloc-drop (- depth 1)))
    (array-set! ary-2 5 100)
    (and 
      prev-ok
      (== (array-get ary-1 4) depth)
      (== (array-get ary-2 4) depth)
      (== (array-get (array-get ary-1 2) 4) depth)
      (== (array-get (array-get ary-2 2) 4) depth)
      (== (array-get ary-1 5) 100)
      (== (array-get ary-2 5) 100)
      (== (array-get (array-get ary-1 2) 5) 100)
      (== (array-get (array-get ary-2 2) 5) 100)))
  (fun alloc-drop (depth)
    (make-array 100)
    (if (> depth 0) (alloc-use-vec (- depth 1)) true))
  (fun make-array (length)
    (do ((arry (array-new) arry)
         (i 0 (+ i 1)))
      ((>= i length) arry)
      (array-push! arry (i))))
  (println (alloc-drop-vec 10000)))
